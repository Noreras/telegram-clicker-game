<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ—Ñ–µ–π–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1a1a2e;
        }
        
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
        }
        
        #game-canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #0f3460;
        }
        
        #game-ui {
            position: fixed;
            top: max(env(safe-area-inset-top, 0px), 10px);
            left: 0;
            right: 0;
            padding: 12px 16px;
            background: linear-gradient(to bottom, rgba(26, 26, 46, 0.95), rgba(26, 26, 46, 0.8));
            color: white;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00adb5;
        }
        
        .ui-item {
            text-align: center;
        }
        
        .ui-label {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 4px;
            color: #a0a0c0;
        }
        
        .ui-value {
            font-size: 16px;
            font-weight: 700;
            color: #00adb5;
        }
        
        #location-indicator {
            position: fixed;
            top: max(env(safe-area-inset-top, 0px), 10px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 173, 181, 0.9);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            z-index: 99;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-top: 70px;
        }
        
        .notification {
            position: fixed;
            top: max(env(safe-area-inset-top, 0px), 10px);
            right: 16px;
            background: #00adb5;
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            margin-top: 120px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        #day-end-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 1000;
        }
        
        .panel-content {
            background: #16213e;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 3px solid #00adb5;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }
        
        .panel-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: #00adb5;
            font-weight: 700;
        }
        
        .panel-stat {
            font-size: 17px;
            margin: 12px 0;
            color: #e0e0ff;
        }
        
        .panel-highlight {
            color: #00ff9d;
            font-weight: 700;
        }
        
        .panel-button {
            background: linear-gradient(135deg, #00adb5, #0097a7);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 25px;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .panel-button:active {
            transform: scale(0.98);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* –û–∫–Ω–æ –∑–∞–∫–∞–∑–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ */
        #order-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 1001;
        }
        
        .order-content {
            background: #16213e;
            border-radius: 20px;
            padding: 25px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            border: 3px solid #00adb5;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }
        
        .order-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #00adb5;
            font-weight: 700;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2d4059;
        }
        
        .order-info {
            text-align: left;
            flex-grow: 1;
        }
        
        .order-name {
            font-size: 16px;
            color: #e0e0ff;
            font-weight: 600;
        }
        
        .order-price {
            font-size: 14px;
            color: #a0a0c0;
            margin-top: 2px;
        }
        
        .order-button {
            background: #00adb5;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            min-width: 80px;
        }
        
        .order-button:disabled {
            background: #607D8B;
            cursor: not-allowed;
        }
        
        .close-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        
        #instructions {
            position: fixed;
            bottom: max(env(safe-area-inset-bottom, 0px), 20px);
            left: 16px;
            right: 16px;
            background: rgba(26, 26, 46, 0.9);
            color: #a0a0c0;
            padding: 15px;
            border-radius: 15px;
            font-size: 13px;
            line-height: 1.4;
            text-align: center;
            z-index: 99;
            border: 1px solid #2d4059;
        }
        
        #progress-bar {
            position: fixed;
            bottom: max(env(safe-area-inset-bottom, 0px), 100px);
            left: 16px;
            right: 16px;
            height: 8px;
            background: rgba(45, 64, 89, 0.5);
            border-radius: 4px;
            overflow: hidden;
            z-index: 99;
        }
        
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00adb5, #00ff9d);
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (max-width: 480px) {
            #game-ui {
                padding: 10px 12px;
                gap: 6px;
            }
            
            .ui-label {
                font-size: 10px;
            }
            
            .ui-value {
                font-size: 14px;
            }
            
            #location-indicator {
                font-size: 12px;
                padding: 6px 16px;
                margin-top: 60px;
            }
            
            .notification {
                font-size: 13px;
                margin-top: 100px;
            }
            
            .order-content {
                padding: 20px;
            }
            
            .order-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-ui">
            <div class="ui-item">
                <div class="ui-label">–ë–ê–õ–ê–ù–°</div>
                <div class="ui-value" id="money">$100</div>
            </div>
            <div class="ui-item">
                <div class="ui-label">–î–ï–ù–¨</div>
                <div class="ui-value" id="day">1</div>
            </div>
            <div class="ui-item">
                <div class="ui-label">–ö–õ–ò–ï–ù–¢–´</div>
                <div class="ui-value" id="customers">0/5</div>
            </div>
            <div class="ui-item">
                <div class="ui-label">–í–†–ï–ú–Ø</div>
                <div class="ui-value" id="day-time">3:00</div>
            </div>
        </div>
        
        <div id="location-indicator">–ë–ê–†–ù–ê–Ø –ó–û–ù–ê</div>
        
        <canvas id="game-canvas"></canvas>
        
        <div id="progress-bar">
            <div id="progress-fill"></div>
        </div>
        
        <div id="instructions">
            üëÜ –¢–∞–ø–Ω–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è ‚Ä¢ üéØ –¢–∞–ø–Ω–∏—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–Ω—è -->
        <div id="day-end-panel">
            <div class="panel-content">
                <div class="panel-title">üéâ –°–ú–ï–ù–ê –ó–ê–í–ï–†–®–ï–ù–ê!</div>
                <div class="panel-stat">–û–±—Å–ª—É–∂–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: <span class="panel-highlight" id="served-count">0</span></div>
                <div class="panel-stat">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –¥–µ–Ω—å: <span class="panel-highlight" id="earned-money">$0</span></div>
                <div class="panel-stat">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –∑–∞–∫—É–ø–∫–∏: <span class="panel-highlight" id="spent-money">$0</span></div>
                <div class="panel-stat">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: <span class="panel-highlight" id="net-profit">$0</span></div>
                <div class="panel-stat">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: <span class="panel-highlight" id="total-money">$100</span></div>
                <button class="panel-button" onclick="startNewDay()">–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å</button>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –∑–∞–∫–∞–∑–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ -->
        <div id="order-panel">
            <div class="order-content">
                <div class="order-title">üì¶ –ó–ê–ö–ê–ó–ê–¢–¨ –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´</div>
                
                <div class="order-item">
                    <div class="order-info">
                        <div class="order-name">‚òï –ö–æ—Ñ–µ</div>
                        <div class="order-price">+10 –∑–∞ $200</div>
                    </div>
                    <button class="order-button" onclick="orderIngredient('coffee', 200)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                </div>
                
                <div class="order-item">
                    <div class="order-info">
                        <div class="order-name">üçµ –ß–∞–π</div>
                        <div class="order-price">+10 –∑–∞ $150</div>
                    </div>
                    <button class="order-button" onclick="orderIngredient('tea', 150)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                </div>
                
                <div class="order-item">
                    <div class="order-info">
                        <div class="order-name">ü•õ –ú–æ–ª–æ–∫–æ</div>
                        <div class="order-price">+10 –∑–∞ $300</div>
                    </div>
                    <button class="order-button" onclick="orderIngredient('milk', 300)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                </div>
                
                <div class="order-item">
                    <div class="order-info">
                        <div class="order-name">üçØ –°–∏—Ä–æ–ø</div>
                        <div class="order-price">+10 –∑–∞ $250</div>
                    </div>
                    <button class="order-button" onclick="orderIngredient('syrup', 250)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                </div>
                
                <button class="close-button" onclick="closeOrderPanel()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    <script>
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            location: 'bar',
            money: 100,
            day: 1,
            customersToday: 0,
            customersServed: 0,
            dayTime: 180,
            dayActive: true,
            earnedThisDay: 0,
            spentThisDay: 0, // –ù–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç—Ä–∞—Ç –Ω–∞ –∑–∞–∫—É–ø–∫–∏
            
            inventory: {
                coffee: 10,
                tea: 10,
                milk: 0,
                syrup: 0
            },
            
            prices: {
                coffee: 50,
                tea: 40
            },
            
            costs: {
                coffee: 20,    // –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
                tea: 15,       // –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
                milk: 30,      // –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
                syrup: 25      // –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
            },
            
            storageCapacity: {
                coffee: 20,
                tea: 20,
                milk: 10,
                syrup: 10
            },
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–µ–º –∑–∞–∫–∞–∑–æ–≤ (–∫–∞—Å—Å–∞ —É–±—Ä–∞–Ω–∞)
            currentCustomer: null,
            currentOrder: null,
            isPreparing: false,
            preparationProgress: 0,
            preparationTotal: 0,
            
            player: {
                x: 0,
                y: 0,
                size: 20,
                color: '#000000',
                targetX: null,
                targetY: null,
                speed: 4,
                isMoving: false,
                interactionTarget: null
            },
            
            customers: [],
            nextCustomerTime: 0,
            
            objects: {
                bar: [],
                storage: []
            },
            
            lastTimeUpdate: Date.now()
        };
        
        // ==================== –†–ê–ó–ú–ï–†–´ –ò –û–ë–™–ï–ö–¢–´ ====================
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initObjects();
        }
        
        function initObjects() {
            const width = canvas.width;
            const height = canvas.height;
            const objSize = Math.min(width, height) * 0.05;
            
            gameState.player.size = Math.min(width, height) * 0.04;
            
            // –ë–∞—Ä–Ω–∞—è –∑–æ–Ω–∞ (–ö–ê–°–°–ê –ò–ó–ú–ï–ù–ï–ù–ê –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É)
            gameState.objects.bar = [
                { 
                    id: 'statistics', type: 'statistics', // –ë–´–õ–û: 'cashier'
                    x: width * 0.15, y: height * 0.2, 
                    width: objSize * 2, height: objSize * 1.5, 
                    color: '#3498db', label: 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                    collision: true
                },
                { 
                    id: 'coffee_machine', type: 'machine', 
                    x: width * 0.3, y: height * 0.2, 
                    width: objSize * 1.5, height: objSize * 1.5, 
                    color: '#e74c3c', label: '–ö–æ—Ñ–µ',
                    collision: true
                },
                { 
                    id: 'tea_maker', type: 'machine', 
                    x: width * 0.45, y: height * 0.2, 
                    width: objSize * 1.5, height: objSize * 1.5, 
                    color: '#2ecc71', label: '–ß–∞–π',
                    collision: true
                },
                { 
                    id: 'table1', type: 'table', 
                    x: width * 0.25, y: height * 0.7, 
                    width: objSize * 3, height: objSize * 1.5, 
                    color: '#9b59b6', label: '–°—Ç–æ–ª 1',
                    collision: true
                },
                { 
                    id: 'table2', type: 'table', 
                    x: width * 0.5, y: height * 0.7, 
                    width: objSize * 3, height: objSize * 1.5, 
                    color: '#9b59b6', label: '–°—Ç–æ–ª 2',
                    collision: true
                },
                { 
                    id: 'door', type: 'door', 
                    x: width * 0.9, y: height * 0.5, 
                    width: objSize * 0.8, height: objSize * 3, 
                    color: '#f39c12', label: '‚Üí –°–∫–ª–∞–¥',
                    collision: false
                }
            ];
            
            // –°–∫–ª–∞–¥ (–î–û–°–ö–ê –ó–ê–ö–ê–ó–û–í –ò–ó–ú–ï–ù–ï–ù–ê - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é)
            gameState.objects.storage = [
                { 
                    id: 'coffee_shelf', type: 'shelf', 
                    x: width * 0.2, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#795548', label: '–ö–æ—Ñ–µ',
                    collision: true
                },
                { 
                    id: 'tea_shelf', type: 'shelf', 
                    x: width * 0.4, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#4CAF50', label: '–ß–∞–π',
                    collision: true
                },
                { 
                    id: 'milk_shelf', type: 'shelf', 
                    x: width * 0.6, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#FFEBEE', label: '–ú–æ–ª–æ–∫–æ',
                    collision: true
                },
                { 
                    id: 'syrup_shelf', type: 'shelf', 
                    x: width * 0.8, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#FF9800', label: '–°–∏—Ä–æ–ø',
                    collision: true
                },
                { 
                    id: 'order_board', type: 'board', // –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –∑–∞–∫–∞–∑–∞
                    x: width * 0.4, y: height * 0.6, 
                    width: objSize * 4, height: objSize * 2, 
                    color: '#607D8B', label: 'üì¶ –ó–∞–∫–∞–∑–∞—Ç—å',
                    collision: true
                },
                { 
                    id: 'end_day', type: 'button', 
                    x: width * 0.4, y: height * 0.8, 
                    width: objSize * 5, height: objSize * 2, 
                    color: '#e74c3c', label: '–ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É',
                    collision: true
                },
                { 
                    id: 'door_back', type: 'door', 
                    x: width * 0.1, y: height * 0.5, 
                    width: objSize * 0.8, height: objSize * 3, 
                    color: '#f39c12', label: '‚Üê –ë–∞—Ä',
                    collision: false
                }
            ];
            
            updatePlayerPosition();
        }
        
        function updatePlayerPosition() {
            const width = canvas.width;
            const height = canvas.height;
            
            if (gameState.location === 'bar') {
                gameState.player.x = width * 0.1;
                gameState.player.y = height * 0.5;
            } else {
                gameState.player.x = width * 0.9;
                gameState.player.y = height * 0.5;
            }
            
            gameState.player.targetX = null;
            gameState.player.targetY = null;
            gameState.player.interactionTarget = null;
        }
        
        // ==================== –ö–û–õ–õ–ò–ó–ò–ò ====================
        function checkCollision(x, y, object) {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–æ–Ω—É –∫–ª–∏–∫–∞ –¥–ª—è –¥–≤–µ—Ä–µ–π
            const clickMargin = object.type === 'door' ? 30 : 0;
            
            const left = object.x - object.width / 2 - clickMargin;
            const right = object.x + object.width / 2 + clickMargin;
            const top = object.y - object.height / 2 - clickMargin;
            const bottom = object.y + object.height / 2 + clickMargin;
            
            return x >= left && x <= right && y >= top && y <= bottom;
        }
        
        function isValidPosition(x, y) {
            const objects = gameState.objects[gameState.location];
            
            for (const obj of objects) {
                if (obj.collision) {
                    const margin = gameState.player.size * 1.5;
                    const left = obj.x - obj.width / 2 - margin;
                    const right = obj.x + obj.width / 2 + margin;
                    const top = obj.y - obj.height / 2 - margin;
                    const bottom = obj.y + obj.height / 2 + margin;
                    
                    if (x >= left && x <= right && y >= top && y <= bottom) {
                        return false;
                    }
                }
            }
            
            const margin = gameState.player.size;
            return x >= margin && 
                   x <= canvas.width - margin && 
                   y >= margin && 
                   y <= canvas.height - margin;
        }
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showNotification(text) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = text;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 2500);
            
            if (window.Telegram && window.Telegram.WebApp) {
                try {
                    window.Telegram.WebApp.showAlert(text);
                } catch (e) {}
            }
        }
        
        function updateUI() {
            document.getElementById('money').textContent = `$${gameState.money}`;
            document.getElementById('day').textContent = gameState.day;
            document.getElementById('customers').textContent = `${gameState.customersServed}/${gameState.customersToday}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            const now = Date.now();
            if (now - gameState.lastTimeUpdate > 1000) {
                if (gameState.dayTime > 0) {
                    gameState.dayTime--;
                }
                gameState.lastTimeUpdate = now;
            }
            
            const minutes = Math.floor(gameState.dayTime / 60);
            const seconds = gameState.dayTime % 60;
            document.getElementById('day-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('location-indicator').textContent = 
                gameState.location === 'bar' ? '–ë–ê–†–ù–ê–Ø –ó–û–ù–ê' : '–°–ö–õ–ê–î';
            
            const progress = (gameState.customersServed / Math.max(gameState.customersToday, 1)) * 100;
            document.getElementById('progress-fill').style.width = `${Math.min(progress, 100)}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∑–∞–∫–∞–∑–∞
            updateOrderButtons();
        }
        
        // ==================== –ü–ê–ù–ï–õ–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
        function showOrderPanel() {
            document.getElementById('order-panel').style.display = 'flex';
        }
        
        function closeOrderPanel() {
            document.getElementById('order-panel').style.display = 'none';
        }
        
        function updateOrderButtons() {
            const ingredients = ['coffee', 'tea', 'milk', 'syrup'];
            ingredients.forEach(ingredient => {
                const current = gameState.inventory[ingredient];
                const max = gameState.storageCapacity[ingredient];
                const need = max - current;
                const button = document.querySelector(`.order-button[onclick*="${ingredient}"]`);
                
                if (button) {
                    if (need <= 0) {
                        button.textContent = '–ü–æ–ª–Ω—ã–π';
                        button.disabled = true;
                    } else if (gameState.money < getOrderCost(ingredient)) {
                        button.textContent = '–ù–µ—Ç –¥–µ–Ω–µ–≥';
                        button.disabled = true;
                    } else {
                        button.textContent = '–ó–∞–∫–∞–∑–∞—Ç—å';
                        button.disabled = false;
                    }
                }
            });
        }
        
        function getOrderCost(ingredient) {
            const costs = {
                'coffee': 200,  // 10 * 20
                'tea': 150,     // 10 * 15
                'milk': 300,    // 10 * 30
                'syrup': 250    // 10 * 25
            };
            return costs[ingredient] || 0;
        }
        
        function orderIngredient(ingredient, cost) {
            const current = gameState.inventory[ingredient];
            const max = gameState.storageCapacity[ingredient];
            const need = max - current;
            
            if (need <= 0) {
                showNotification('–ó–∞–ø–∞—Å —É–∂–µ –ø–æ–ª–Ω—ã–π!');
                return;
            }
            
            if (gameState.money < cost) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                return;
            }
            
            // –ü–æ–∫—É–ø–∞–µ–º 10 –µ–¥–∏–Ω–∏—Ü (–∏–ª–∏ —Å–∫–æ–ª—å–∫–æ –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è)
            const quantity = Math.min(10, need);
            const actualCost = (cost / 10) * quantity;
            
            gameState.inventory[ingredient] += quantity;
            gameState.money -= actualCost;
            gameState.spentThisDay += actualCost;
            
            const ingredientNames = {
                'coffee': '–∫–æ—Ñ–µ',
                'tea': '—á–∞–π',
                'milk': '–º–æ–ª–æ–∫–æ',
                'syrup': '—Å–∏—Ä–æ–ø'
            };
            
            showNotification(`‚úÖ –ó–∞–∫–∞–∑–∞–Ω–æ ${quantity} ${ingredientNames[ingredient]} –∑–∞ $${actualCost}`);
            updateUI();
            updateOrderButtons();
        }
        
        // ==================== –°–ò–°–¢–ï–ú–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ò ====================
        function showStatistics() {
            const netProfit = gameState.earnedThisDay - gameState.spentThisDay;
            const stats = `üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –î–ù–Ø:
–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: $${gameState.earnedThisDay}
–ü–æ—Ç—Ä–∞—á–µ–Ω–æ: $${gameState.spentThisDay}
–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: $${netProfit}
–û–±—Å–ª—É–∂–µ–Ω–æ: ${gameState.customersServed}/5 –∫–ª–∏–µ–Ω—Ç–æ–≤`;
            
            showNotification(stats);
        }
          // ==================== –ö–õ–ò–ï–ù–¢–´ ====================
        function spawnCustomer() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ç–æ–ª–∏–∫–∏ (–º–∞–∫—Å 2 –∫–ª–∏–µ–Ω—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
            const freeTables = 2 - gameState.customers.length;
            if (freeTables <= 0 || gameState.customersToday >= 5 || !gameState.dayActive) {
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–π —Å—Ç–æ–ª–∏–∫
            const occupiedTables = gameState.customers.map(c => c.table);
            const freeTable = !occupiedTables.includes('table1') ? 'table1' : 'table2';
            
            const customer = {
                id: Date.now(),
                table: freeTable,
                x: canvas.width + 50,
                y: canvas.height * 0.2,
                size: Math.min(canvas.width, canvas.height) * 0.03,
                color: '#FFFFFF', // –ë–µ–ª—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (–∏–¥–µ—Ç)
                state: 'walking',
                order: null,
                patience: 100,
                patienceTimer: 0
            };
            
            // –°–ª—É—á–∞–π–Ω—ã–π –∑–∞–∫–∞–∑ (–∫–æ—Ñ–µ –∏–ª–∏ —á–∞–π)
            const orders = ['coffee', 'tea'];
            customer.order = orders[Math.floor(Math.random() * orders.length)];
            
            gameState.customers.push(customer);
            gameState.customersToday++;
            gameState.nextCustomerTime = Date.now() + 15000; // –°–ª–µ–¥—É—é—â–∏–π —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
            
            showNotification('üÜï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç!');
            updateUI();
        }
        
        function updateCustomers() {
            for (let i = gameState.customers.length - 1; i >= 0; i--) {
                const customer = gameState.customers[i];
                
                if (customer.state === 'walking') {
                    const table = gameState.objects.bar.find(obj => obj.id === customer.table);
                    const targetX = table.x;
                    const targetY = table.y - table.height/2 - customer.size;
                    
                    const dx = targetX - customer.x;
                    const dy = targetY - customer.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 5) {
                        customer.state = 'waiting';
                        customer.color = '#FFFF00'; // –ñ–µ–ª—Ç—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (–∂–¥–µ—Ç)
                        // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ø—Ä–∏–Ω–∏–º–∞–µ–º –∑–∞–∫–∞–∑ –ø—Ä–∏ –ø–æ–¥—Ö–æ–¥–µ –∫ —Å—Ç–æ–ª–∏–∫—É
                        if (!gameState.currentCustomer) {
                            gameState.currentCustomer = customer;
                            showNotification(`–ö–ª–∏–µ–Ω—Ç –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç: ${customer.order === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'}`);
                        }
                    } else {
                        customer.x += (dx / distance) * 3;
                        customer.y += (dy / distance) * 3;
                    }
                }
                else if (customer.state === 'eating') {
                    customer.patienceTimer++;
                    // –ï—Å—Ç 5 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 3)
                    if (customer.patienceTimer > 300) { // 5 —Å–µ–∫—É–Ω–¥ * 60 FPS
                        customer.state = 'leaving';
                        customer.color = '#FFFFFF'; // –ë–µ–ª—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (—É—Ö–æ–¥–∏—Ç)
                    }
                }
                else if (customer.state === 'leaving') {
                    customer.x += 3;
                    if (customer.x > canvas.width + 100) {
                        gameState.customers.splice(i, 1);
                    }
                }
                else if (customer.state === 'waiting') {
                    customer.patienceTimer++;
                    // –ñ–¥–µ—Ç 30 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 60)
                    if (customer.patienceTimer > 1800) { // 30 —Å–µ–∫—É–Ω–¥ * 60 FPS
                        customer.state = 'leaving';
                        customer.color = '#FFFFFF';
                        showNotification('üò† –ö–ª–∏–µ–Ω—Ç —É—à–µ–ª –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π');
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑—á–∏–∫, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–∞–∫–∞–∑
                        if (gameState.currentCustomer && gameState.currentCustomer.id === customer.id) {
                            gameState.currentCustomer = null;
                            gameState.currentOrder = null;
                        }
                    }
                }
            }
        }
        
        function serveCustomer(tableId, drinkType) {
            const customer = gameState.customers.find(c => c.table === tableId && c.state === 'waiting');
            if (!customer) return false;
            
            if (customer.order === drinkType && gameState.inventory[drinkType] > 0) {
                customer.state = 'eating';
                customer.color = '#00FF00'; // –ó–µ–ª–µ–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (–µ—Å—Ç)
                customer.patienceTimer = 0;
                
                const earned = gameState.prices[drinkType];
                gameState.money += earned;
                gameState.earnedThisDay += earned;
                gameState.customersServed++;
                gameState.inventory[drinkType]--;
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑
                if (gameState.currentCustomer && gameState.currentCustomer.id === customer.id) {
                    gameState.currentCustomer = null;
                    gameState.currentOrder = null;
                }
                
                showNotification(`‚úÖ –û–±—Å–ª—É–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç! +$${earned}`);
                updateUI();
                return true;
            }
            return false;
        }
        
        // ==================== –ü–ï–†–°–û–ù–ê–ñ ====================
        function updatePlayer() {
            const player = gameState.player;
            
            if (player.targetX !== null && player.targetY !== null) {
                const dx = player.targetX - player.x;
                const dy = player.targetY - player.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.speed) {
                    player.x = player.targetX;
                    player.y = player.targetY;
                    player.targetX = null;
                    player.targetY = null;
                    player.isMoving = false;
                    player.color = '#000000'; // –ß–µ—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç (—Å—Ç–æ–∏—Ç)
                    
                    if (player.interactionTarget) {
                        setTimeout(() => interactWithObject(player.interactionTarget), 100);
                        player.interactionTarget = null;
                    }
                } else {
                    const nextX = player.x + (dx / distance) * player.speed;
                    const nextY = player.y + (dy / distance) * player.speed;
                    
                    if (isValidPosition(nextX, nextY)) {
                        player.x = nextX;
                        player.y = nextY;
                        player.isMoving = true;
                        player.color = '#808080'; // –°–µ—Ä—ã–π –∫–≤–∞–¥—Ä–∞—Ç (–∏–¥–µ—Ç)
                    } else {
                        // –ü–æ–∏—Å–∫ –æ–±—Ö–æ–¥–Ω–æ–≥–æ –ø—É—Ç–∏
                        const angles = [0, Math.PI/4, -Math.PI/4, Math.PI/2, -Math.PI/2];
                        for (const angle of angles) {
                            const offsetX = Math.cos(angle) * player.speed * 2;
                            const offsetY = Math.sin(angle) * player.speed * 2;
                            
                            if (isValidPosition(player.x + offsetX, player.y + offsetY)) {
                                player.targetX = player.x + offsetX;
                                player.targetY = player.y + offsetY;
                                return;
                            }
                        }
                        
                        player.targetX = null;
                        player.targetY = null;
                        player.interactionTarget = null;
                        showNotification('üö´ –ü—É—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                    }
                }
            }
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï ====================
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç
            const objects = gameState.objects[gameState.location];
            let clickedObject = null;
            
            for (const obj of objects) {
                // –î–ª—è –¥–≤–µ—Ä–µ–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–æ–Ω—É –∫–ª–∏–∫–∞
                const margin = obj.type === 'door' ? 30 : 10;
                const left = obj.x - obj.width / 2 - margin;
                const right = obj.x + obj.width / 2 + margin;
                const top = obj.y - obj.height / 2 - margin;
                const bottom = obj.y + obj.height / 2 + margin;
                
                if (x >= left && x <= right && y >= top && y <= bottom) {
                    clickedObject = obj;
                    break;
                }
            }
            
            if (clickedObject) {
                // –î–≤–∏–≥–∞–µ–º—Å—è –∫ –æ–±—ä–µ–∫—Ç—É –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
                const safeDistance = clickedObject.type === 'door' ? 10 : gameState.player.size * 1.5;
                const angle = Math.atan2(clickedObject.y - gameState.player.y, clickedObject.x - gameState.player.x);
                const targetX = clickedObject.x - Math.cos(angle) * safeDistance;
                const targetY = clickedObject.y - Math.sin(angle) * safeDistance;
                
                if (isValidPosition(targetX, targetY)) {
                    gameState.player.targetX = targetX;
                    gameState.player.targetY = targetY;
                    gameState.player.interactionTarget = clickedObject;
                    showNotification(`–ò–¥—É –∫ ${clickedObject.label.toLowerCase()}...`);
                } else {
                    // –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–π—Ç–∏ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                    const alternativeX = clickedObject.x + Math.cos(angle) * safeDistance;
                    const alternativeY = clickedObject.y + Math.sin(angle) * safeDistance;
                    
                    if (isValidPosition(alternativeX, alternativeY)) {
                        gameState.player.targetX = alternativeX;
                        gameState.player.targetY = alternativeY;
                        gameState.player.interactionTarget = clickedObject;
                        showNotification(`–ò–¥—É –∫ ${clickedObject.label.toLowerCase()}...`);
                    } else {
                        showNotification('–ù–µ –º–æ–≥—É –ø–æ–¥–æ–π—Ç–∏ –∫ –æ–±—ä–µ–∫—Ç—É!');
                    }
                }
            } else {
                // –ü—Ä–æ—Å—Ç–æ –¥–≤–∏–≥–∞–µ–º—Å—è –∫ —Ç–æ—á–∫–µ
                if (isValidPosition(x, y)) {
                    gameState.player.targetX = x;
                    gameState.player.targetY = y;
                    gameState.player.interactionTarget = null;
                } else {
                    showNotification('–ù–µ –º–æ–≥—É –¥–æ–π—Ç–∏ –¥–æ —ç—Ç–æ–π —Ç–æ—á–∫–∏!');
                }
            }
        });
        
        // ==================== –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø –° –û–ë–™–ï–ö–¢–ê–ú–ò ====================
        function interactWithObject(object) {
            if (object.type === 'door') {
                // –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏—è–º–∏
                gameState.location = gameState.location === 'bar' ? 'storage' : 'bar';
                updatePlayerPosition();
                showNotification(`–ü–µ—Ä–µ—à–ª–∏ –≤ ${gameState.location === 'bar' ? '–±–∞—Ä' : '—Å–∫–ª–∞–¥'}`);
            }
            else if (object.type === 'statistics') {
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–Ω—è (–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–∞—Å—Å—ã)
                showStatistics();
            }
            else if (object.type === 'machine' && gameState.currentOrder) {
                // –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–∞
                if (gameState.inventory[gameState.currentOrder] <= 0) {
                    showNotification('‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!');
                    return;
                }
                
                gameState.isPreparing = true;
                gameState.preparationProgress = 0;
                gameState.preparationTotal = gameState.currentOrder === 'coffee' ? 180 : 120; // 3 –∏–ª–∏ 2 —Å–µ–∫—É–Ω–¥—ã
                gameState.player.color = '#FFFF00'; // –ñ–µ–ª—Ç—ã–π –∫–≤–∞–¥—Ä–∞—Ç (—Ä–∞–±–æ—Ç–∞–µ—Ç)
                showNotification(`–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ ${gameState.currentOrder === 'coffee' ? '–∫–æ—Ñ–µ' : '—á–∞—è'}...`);
            }
            else if (object.type === 'table') {
                // –û—Ç–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç—É
                const drinkType = gameState.currentOrder;
                if (drinkType && serveCustomer(object.id, drinkType)) {
                    gameState.currentOrder = null;
                    gameState.isPreparing = false;
                    gameState.player.color = '#000000'; // –ß–µ—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç (—Å—Ç–æ–∏—Ç)
                }
            }
            else if (object.type === 'shelf') {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø–∞—Å–∞—Ö
                const ingredient = object.id.replace('_shelf', '');
                const current = gameState.inventory[ingredient];
                const max = gameState.storageCapacity[ingredient];
                
                const ingredientNames = {
                    'coffee': '–ö–æ—Ñ–µ',
                    'tea': '–ß–∞–π',
                    'milk': '–ú–æ–ª–æ–∫–æ',
                    'syrup': '–°–∏—Ä–æ–ø'
                };
                
                showNotification(`${ingredientNames[ingredient]}: ${current}/${max}`);
            }
            else if (object.type === 'board') {
                // –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∑–∞–∫–∞–∑–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                showOrderPanel();
            }
            else if (object.type === 'button' && object.id === 'end_day') {
                // –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å
                endDay();
            }
        }
        
        // ==================== –°–ò–°–¢–ï–ú–ê –î–ù–ï–ô ====================
        function endDay() {
            gameState.dayActive = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ –ø–∞–Ω–µ–ª–∏
            const netProfit = gameState.earnedThisDay - gameState.spentThisDay;
            document.getElementById('served-count').textContent = gameState.customersServed;
            document.getElementById('earned-money').textContent = `$${gameState.earnedThisDay}`;
            document.getElementById('spent-money').textContent = `$${gameState.spentThisDay}`;
            document.getElementById('net-profit').textContent = `$${netProfit}`;
            document.getElementById('total-money').textContent = `$${gameState.money}`;
            
            document.getElementById('day-end-panel').style.display = 'flex';
            showNotification(`üìä –î–µ–Ω—å ${gameState.day} –∑–∞–≤–µ—Ä—à–µ–Ω!`);
        }
        
        function startNewDay() {
            gameState.day++;
            gameState.customersToday = 0;
            gameState.customersServed = 0;
            gameState.dayTime = 180;
            gameState.dayActive = true;
            gameState.earnedThisDay = 0;
            gameState.spentThisDay = 0;
            gameState.customers = [];
            gameState.currentCustomer = null;
            gameState.currentOrder = null;
            gameState.isPreparing = false;
            gameState.nextCustomerTime = Date.now() + 5000;
            gameState.lastTimeUpdate = Date.now();
            
            document.getElementById('day-end-panel').style.display = 'none';
            showNotification(`üéÆ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–Ω—å ${gameState.day}!`);
            updateUI();
        }
        
        // ==================== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ====================
        function updateGame() {
            if (!gameState.dayActive) return;
            
            // –°–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ç–æ–ª–∏–∫–∏)
            if (Date.now() > gameState.nextCustomerTime && gameState.customersToday < 5) {
                spawnCustomer();
            }
            
            updateCustomers();
            updatePlayer();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–∞
            if (gameState.isPreparing) {
                gameState.preparationProgress++;
                if (gameState.preparationProgress >= gameState.preparationTotal) {
                    gameState.isPreparing = false;
                    gameState.player.color = '#000000'; // –ß–µ—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç (—Å—Ç–æ–∏—Ç)
                    showNotification(`‚úÖ ${gameState.currentOrder === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'} –≥–æ—Ç–æ–≤!`);
                }
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞–µ–º –∑–∞–∫–∞–∑—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ —Ä—è–¥–æ–º —Å–æ —Å—Ç–æ–ª–∏–∫–æ–º)
            // –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –≤ updateCustomers()
            
            updateUI();
        }
              // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
        function drawGame() {
            // –û—á–∏—Å—Ç–∫–∞
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –æ–±—ä–µ–∫—Ç—ã —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
            const objects = gameState.objects[gameState.location];
            objects.forEach(obj => {
                // –û–±—ä–µ–∫—Ç
                ctx.fillStyle = obj.color;
                ctx.fillRect(
                    obj.x - obj.width/2, 
                    obj.y - obj.height/2, 
                    obj.width, 
                    obj.height
                );
                
                // –ö–æ–Ω—Ç—É—Ä
                ctx.strokeStyle = obj.collision ? '#ffffff' : '#ffcc00';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    obj.x - obj.width/2, 
                    obj.y - obj.height/2, 
                    obj.width, 
                    obj.height
                );
                
                // –ü–æ–¥–ø–∏—Å—å
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.min(canvas.width, canvas.height) * 0.02}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(obj.label, obj.x, obj.y);
            });
            
            // –†–∏—Å—É–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ –±–∞—Ä–µ) - –í–°–ï–ì–î–ê –¢–†–ï–£–ì–û–õ–¨–ù–ò–ö
            if (gameState.location === 'bar') {
                gameState.customers.forEach(customer => {
                    ctx.fillStyle = customer.color;
                    
                    // –í–°–ï–ì–î–ê —Ä–∏—Å—É–µ–º —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
                    ctx.beginPath();
                    ctx.moveTo(customer.x, customer.y - customer.size/2);
                    ctx.lineTo(customer.x - customer.size/2, customer.y + customer.size/2);
                    ctx.lineTo(customer.x + customer.size/2, customer.y + customer.size/2);
                    ctx.closePath();
                    ctx.fill();
                    
                    // –ö–æ–Ω—Ç—É—Ä —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    
                    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–¥—É—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)
                    if (customer.state === 'waiting') {
                        ctx.fillStyle = customer.order === 'coffee' ? '#8B4513' : '#4CAF50';
                        ctx.beginPath();
                        ctx.arc(customer.x, customer.y - customer.size * 1.5, customer.size * 0.6, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // –ö–æ–Ω—Ç—É—Ä –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–∫–∞–∑–∞
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        
                        // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ—Ä–ø–µ–Ω–∏—è (–ø–æ–ª–æ—Å–∫–∞ –Ω–∞–¥ –∫–ª–∏–µ–Ω—Ç–æ–º) - 30 —Å–µ–∫—É–Ω–¥
                        const patiencePercent = 1 - (customer.patienceTimer / 1800); // 1800 = 30 —Å–µ–∫ * 60 FPS
                        const barWidth = customer.size * 2;
                        const barHeight = 4;
                        const barX = customer.x - barWidth / 2;
                        const barY = customer.y - customer.size * 2.5;
                        
                        // –§–æ–Ω –ø–æ–ª–æ—Å–∫–∏ —Ç–µ—Ä–ø–µ–Ω–∏—è
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                        ctx.fillRect(barX, barY, barWidth, barHeight);
                        
                        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏ (–º–µ–Ω—è–µ—Ç—Å—è –æ—Ç –∑–µ–ª–µ–Ω–æ–≥–æ –∫ –∫—Ä–∞—Å–Ω–æ–º—É)
                        const hue = patiencePercent * 120; // 120 = –∑–µ–ª–µ–Ω—ã–π, 0 = –∫—Ä–∞—Å–Ω—ã–π
                        ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                        ctx.fillRect(barX, barY, barWidth * patiencePercent, barHeight);
                        
                        // –¢–µ–∫—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
                        const timeLeft = Math.max(0, 30 - Math.floor(customer.patienceTimer / 60));
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(`${timeLeft}—Å`, customer.x, barY - 5);
                    }
                    
                    // –¢–∞–π–º–µ—Ä –µ–¥—ã (–¥–ª—è –µ–¥—è—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤) - 5 —Å–µ–∫—É–Ω–¥
                    if (customer.state === 'eating') {
                        const eatPercent = customer.patienceTimer / 300; // 300 = 5 —Å–µ–∫ * 60 FPS
                        const timeLeft = 5 - Math.floor(customer.patienceTimer / 60);
                        
                        // –¢–µ–∫—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –µ–¥—ã
                        ctx.fillStyle = '#ffffff';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(`–ï—Å—Ç: ${timeLeft}—Å`, customer.x, customer.y - customer.size * 2);
                    }
                });
            }
            
            // –†–∏—Å—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–∫–≤–∞–¥—Ä–∞—Ç)
            const player = gameState.player;
            ctx.fillStyle = player.color;
            ctx.fillRect(
                player.x - player.size/2,
                player.y - player.size/2,
                player.size,
                player.size
            );
            
            // –ö–æ–Ω—Ç—É—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                player.x - player.size/2,
                player.y - player.size/2,
                player.size,
                player.size
            );
            
            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ –Ω–∞–¥ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
            if (gameState.currentOrder) {
                ctx.fillStyle = gameState.currentOrder === 'coffee' ? '#8B4513' : '#4CAF50';
                ctx.beginPath();
                ctx.arc(player.x, player.y - player.size * 2, player.size * 0.8, 0, Math.PI * 2);
                ctx.fill();
                
                // –ö–æ–Ω—Ç—É—Ä –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–∫–∞–∑–∞
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // –¢–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(
                    gameState.currentOrder === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π',
                    player.x,
                    player.y - player.size * 2.5
                );
            }
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–∞
            if (gameState.isPreparing) {
                const progress = gameState.preparationProgress / gameState.preparationTotal;
                const barWidth = canvas.width * 0.6;
                const barHeight = 20;
                const barX = (canvas.width - barWidth) / 2;
                const barY = canvas.height * 0.1;
                
                // –§–æ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(barX, barY, barWidth, barHeight);
                
                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                ctx.fillStyle = '#00adb5';
                ctx.fillRect(barX, barY, barWidth * progress, barHeight);
                
                // –ö–æ–Ω—Ç—É—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(barX, barY, barWidth, barHeight);
                
                // –¢–µ–∫—Å—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const drinkName = gameState.currentOrder === 'coffee' ? '–∫–æ—Ñ–µ' : '—á–∞—è';
                ctx.fillText(
                    `–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ ${drinkName}... ${Math.round(progress * 100)}%`,
                    canvas.width / 2,
                    barY + barHeight / 2
                );
            }
            
            // –†–∏—Å—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ (—Ç–æ–ª—å–∫–æ –Ω–∞ —Å–∫–ª–∞–¥–µ)
            if (gameState.location === 'storage') {
                const startX = 20;
                const startY = canvas.height * 0.15;
                const lineHeight = 20;
                
                // –§–æ–Ω –¥–ª—è —Ç–µ–∫—Å—Ç–∞
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(startX - 10, startY - 10, 200, 120);
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                ctx.fillStyle = '#00adb5';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('üì¶ –ó–ê–ü–ê–°–´:', startX, startY);
                
                // –°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                ctx.font = '14px Arial';
                
                const ingredients = [
                    {key: 'coffee', name: '–ö–æ—Ñ–µ', color: '#795548'},
                    {key: 'tea', name: '–ß–∞–π', color: '#4CAF50'},
                    {key: 'milk', name: '–ú–æ–ª–æ–∫–æ', color: '#FFEBEE'},
                    {key: 'syrup', name: '–°–∏—Ä–æ–ø', color: '#FF9800'}
                ];
                
                ingredients.forEach((ingredient, index) => {
                    const current = gameState.inventory[ingredient.key];
                    const max = gameState.storageCapacity[ingredient.key];
                    const percent = (current / max) * 100;
                    
                    // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏
                    if (percent < 30) ctx.fillStyle = '#e74c3c';
                    else if (percent < 70) ctx.fillStyle = '#f39c12';
                    else ctx.fillStyle = '#2ecc71';
                    
                    ctx.fillText(`${ingredient.name}: ${current}/${max}`, startX, startY + lineHeight * (index + 1));
                });
            }
            
            // –†–∏—Å—É–µ–º —Ü–µ–ª—å –¥–≤–∏–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (gameState.player.targetX && gameState.player.targetY) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.beginPath();
                ctx.arc(gameState.player.targetX, gameState.player.targetY, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#00ff9d';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(gameState.player.targetX, gameState.player.targetY, 12, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∫ —Ü–µ–ª–∏ (–µ—Å–ª–∏ –¥–≤–∏–≥–∞–µ—Ç—Å—è)
            if (gameState.player.targetX && gameState.player.targetY && gameState.player.isMoving) {
                ctx.strokeStyle = 'rgba(0, 173, 181, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(gameState.player.x, gameState.player.y);
                ctx.lineTo(gameState.player.targetX, gameState.player.targetY);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ó–ê–ü–£–°–ö ====================
        function init() {
            resizeCanvas();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                try {
                    Telegram.WebApp.ready();
                    Telegram.WebApp.expand();
                    Telegram.WebApp.setHeaderColor('#1a1a2e');
                    Telegram.WebApp.setBackgroundColor('#1a1a2e');
                    
                    showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ù–∞—á–Ω–∏—Ç–µ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤.');
                } catch (e) {
                    console.log('Telegram Web App –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
                }
            }
            
            // –ü–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (gameState.dayActive) {
                    gameState.nextCustomerTime = Date.now() + 5000;
                }
            }, 5000);
            
            // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            function gameLoop() {
                updateGame();
                drawGame();
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                resizeCanvas();
                drawGame();
            });
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
            canvas.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                return false;
            });
            
            // –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            document.addEventListener('gesturestart', (e) => {
                e.preventDefault();
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ HTML
        window.startNewDay = startNewDay;
        window.orderIngredient = orderIngredient;
        window.closeOrderPanel = closeOrderPanel;
        
        // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
        window.gameState = gameState;
        window.showNotification = showNotification;
        window.showStatistics = showStatistics;
        
        console.log('üéÆ –ö–æ—Ñ–µ–π–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
        console.log('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã:');
        console.log('   1. –ö–ª–∏–µ–Ω—Ç—ã: —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫, –µ–¥—è—Ç 5—Å, –∂–¥—É—Ç 30—Å');
        console.log('   2. –ù–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –µ—Å–ª–∏ –∑–∞–Ω—è—Ç—ã –≤—Å–µ —Å—Ç–æ–ª–∏–∫–∏');
        console.log('   3. –ö–∞—Å—Å–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–º–µ—Å—Ç–æ –ø—Ä–∏–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤');
        console.log('   4. –î–æ—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞');
        console.log(' ');
        console.log('üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:');
        console.log('- gameState - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã');
        console.log('- startNewDay() - –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å');
        console.log('- showNotification("—Ç–µ–∫—Å—Ç") - –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');
        console.log('- showStatistics() - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–Ω—è');
    </script>
</body>
</html>
