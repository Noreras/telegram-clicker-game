<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ñ–µ–π–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
            user-select: none;
        }
        
        body {
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #game-container {
            position: relative;
            background: #34495e;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        #game-ui {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            display: flex;
            justify-content: space-between;
            z-index: 100;
            border-bottom: 2px solid #1abc9c;
        }
        
        .ui-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .ui-title {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .ui-value {
            font-size: 18px;
            font-weight: bold;
            color: #1abc9c;
        }
        
        #game-canvas {
            display: block;
            background: #2c3e50;
            cursor: pointer;
        }
        
        #location-title {
            position: absolute;
            top: 70px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 99;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1abc9c;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        #day-end-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(44, 62, 80, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            color: white;
            z-index: 200;
            display: none;
            border: 3px solid #1abc9c;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .panel-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #1abc9c;
        }
        
        .panel-stats {
            margin: 15px 0;
            font-size: 18px;
        }
        
        .panel-button {
            background: #1abc9c;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        
        .panel-button:hover {
            transform: scale(1.05);
            background: #16a085;
        }
        
        .highlight {
            color: #f1c40f;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ */
        .object-label {
            position: absolute;
            color: white;
            font-size: 12px;
            text-align: center;
            transform: translate(-50%, 10px);
            text-shadow: 1px 1px 2px black;
            pointer-events: none;
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: rgba(255,255,255,0.6);
            font-size: 14px;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-ui">
            <div class="ui-section">
                <div class="ui-title">–ë–ê–õ–ê–ù–°</div>
                <div class="ui-value" id="money">$100</div>
            </div>
            <div class="ui-section">
                <div class="ui-title">–î–ï–ù–¨</div>
                <div class="ui-value" id="day">1</div>
            </div>
            <div class="ui-section">
                <div class="ui-title">–ö–õ–ò–ï–ù–¢–´</div>
                <div class="ui-value" id="customers">0/5</div>
            </div>
            <div class="ui-section">
                <div class="ui-title">–í–†–ï–ú–Ø –î–ù–Ø</div>
                <div class="ui-value" id="day-time">3:00</div>
            </div>
        </div>
        
        <div id="location-title">–ë–ê–†–ù–ê–Ø –ó–û–ù–ê</div>
        
        <canvas id="game-canvas" width="800" height="600"></canvas>
        
        <div id="instructions">
            üéÆ –ö–ª–∏–∫–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞<br>
            üü® –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        </div>
        
        <div id="day-end-panel">
            <div class="panel-title">üéâ –°–ú–ï–ù–ê –ó–ê–í–ï–†–®–ï–ù–ê!</div>
            <div class="panel-stats">–í—ã –æ–±—Å–ª—É–∂–∏–ª–∏ <span class="highlight" id="served-count">0</span> –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
            <div class="panel-stats">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span class="highlight" id="earned-money">$0</span></div>
            <div class="panel-stats">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: <span class="highlight" id="total-money">$100</span></div>
            <button class="panel-button" onclick="startNewDay()">–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å</button>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // –†–∞–∑–º–µ—Ä—ã –∏–≥—Ä—ã
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        
        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let gameState = {
            location: 'bar', // 'bar' –∏–ª–∏ 'storage'
            money: 100,
            day: 1,
            customersToday: 0,
            customersServed: 0,
            dayTime: 180, // 3 –º–∏–Ω—É—Ç—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            dayActive: true,
            earnedThisDay: 0,
            
            inventory: {
                coffee: 10,
                tea: 10,
                milk: 0,
                syrup: 0
            },
            
            // –¶–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            prices: {
                coffee: 50,
                tea: 40
            },
            
            costs: {
                coffee: 20,
                tea: 15,
                milk: 30,
                syrup: 25
            },
            
            storageCapacity: {
                coffee: 20,
                tea: 20,
                milk: 10,
                syrup: 10
            },
            
            // –¢–µ–∫—É—â–∏–µ –∑–∞–∫–∞–∑—ã
            currentCustomer: null,
            currentOrder: null,
            isPreparing: false,
            preparationProgress: 0,
            preparationTotal: 0,
            
            // –ü–µ—Ä—Å–æ–Ω–∞–∂
            player: {
                x: 400,
                y: 300,
                size: 20,
                color: '#000000', // –ß–µ—Ä–Ω—ã–π - —Å—Ç–æ–∏—Ç
                targetX: null,
                targetY: null,
                speed: 3,
                isMoving: false,
                interactionTarget: null
            },
            
            // –ö–ª–∏–µ–Ω—Ç—ã
            customers: [],
            nextCustomerTime: 0,
            
            // –û–±—ä–µ–∫—Ç—ã –∏–≥—Ä—ã
            objects: {
                bar: [
                    { id: 'cashier', type: 'cashier', x: 100, y: 100, width: 40, height: 30, color: '#3498db', label: '–ö–∞—Å—Å–∞' },
                    { id: 'coffee_machine', type: 'machine', x: 200, y: 100, width: 40, height: 40, color: '#e74c3c', label: '–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞' },
                    { id: 'tea_maker', type: 'machine', x: 300, y: 100, width: 40, height: 40, color: '#2ecc71', label: '–ß–∞–π–Ω–∏–∫' },
                    { id: 'table1', type: 'table', x: 150, y: 400, width: 60, height: 40, color: '#8e44ad', label: '–°—Ç–æ–ª–∏–∫ 1' },
                    { id: 'table2', type: 'table', x: 250, y: 400, width: 60, height: 40, color: '#8e44ad', label: '–°—Ç–æ–ª–∏–∫ 2' },
                    { id: 'door', type: 'door', x: 700, y: 300, width: 30, height: 60, color: '#f39c12', label: '–°–∫–ª–∞–¥ ‚Üí' }
                ],
                storage: [
                    { id: 'coffee_shelf', type: 'shelf', x: 200, y: 150, width: 60, height: 80, color: '#795548', label: '–ö–æ—Ñ–µ' },
                    { id: 'tea_shelf', type: 'shelf', x: 300, y: 150, width: 60, height: 80, color: '#4CAF50', label: '–ß–∞–π' },
                    { id: 'milk_shelf', type: 'shelf', x: 400, y: 150, width: 60, height: 80, color: '#FFEBEE', label: '–ú–æ–ª–æ–∫–æ' },
                    { id: 'syrup_shelf', type: 'shelf', x: 500, y: 150, width: 60, height: 80, color: '#FF9800', label: '–°–∏—Ä–æ–ø' },
                    { id: 'order_board', type: 'board', x: 400, y: 300, width: 80, height: 60, color: '#607D8B', label: '–ó–∞–∫–∞–∑–∞—Ç—å' },
                    { id: 'end_day', type: 'button', x: 400, y: 450, width: 100, height: 40, color: '#f44336', label: '–ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É' },
                    { id: 'door_back', type: 'door', x: 100, y: 300, width: 30, height: 60, color: '#f39c12', label: '‚Üê –ë–∞—Ä' }
                ]
            }
        };
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showNotification(text) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = text;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // –ï—Å–ª–∏ –∏–≥—Ä–∞ –≤ Telegram Web App, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.showAlert(text);
            }
        }
        
        function updateUI() {
            document.getElementById('money').textContent = `$${gameState.money}`;
            document.getElementById('day').textContent = gameState.day;
            document.getElementById('customers').textContent = `${gameState.customersServed}/${gameState.customersToday}`;
            
            const minutes = Math.floor(gameState.dayTime / 60);
            const seconds = gameState.dayTime % 60;
            document.getElementById('day-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('location-title').textContent = 
                gameState.location === 'bar' ? '–ë–ê–†–ù–ê–Ø –ó–û–ù–ê' : '–°–ö–õ–ê–î';
        }
        
        // ==================== –ö–õ–ò–ï–ù–¢–´ ====================
        function spawnCustomer() {
            if (gameState.customersToday >= 5 || !gameState.dayActive) return;
            
            const table = gameState.customers.length === 0 ? 'table1' : 'table2';
            const customer = {
                id: Date.now(),
                table: table,
                x: 700,
                y: 100,
                size: 15,
                color: '#FFFFFF', // –ë–µ–ª—ã–π - –∏–¥–µ—Ç
                state: 'walking', // walking, waiting, eating, leaving
                order: null,
                patience: 100,
                patienceTimer: 0
            };
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∑–∞–∫–∞–∑
            const orders = ['coffee', 'tea'];
            customer.order = orders[Math.floor(Math.random() * orders.length)];
            
            gameState.customers.push(customer);
            gameState.customersToday++;
            gameState.nextCustomerTime = Date.now() + 15000; // –°–ª–µ–¥—É—é—â–∏–π —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
            
            showNotification('üÜï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç!');
            updateUI();
        }
        
        function updateCustomers() {
            gameState.customers.forEach((customer, index) => {
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                if (customer.state === 'walking') {
                    const table = gameState.objects.bar.find(obj => obj.id === customer.table);
                    const dx = table.x - customer.x;
                    const dy = table.y - 50 - customer.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 2) {
                        customer.state = 'waiting';
                        customer.color = '#FFFF00'; // –ñ–µ–ª—Ç—ã–π - –∂–¥–µ—Ç
                    } else {
                        customer.x += (dx / distance) * 2;
                        customer.y += (dy / distance) * 2;
                    }
                }
                else if (customer.state === 'eating') {
                    customer.patienceTimer++;
                    if (customer.patienceTimer > 180) { // –ï—Å—Ç 3 —Å–µ–∫—É–Ω–¥—ã
                        customer.state = 'leaving';
                        customer.color = '#FFFFFF'; // –ë–µ–ª—ã–π - —É—Ö–æ–¥–∏—Ç
                    }
                }
                else if (customer.state === 'leaving') {
                    customer.x += 2;
                    if (customer.x > 850) {
                        gameState.customers.splice(index, 1);
                    }
                }
                else if (customer.state === 'waiting') {
                    customer.patienceTimer++;
                    if (customer.patienceTimer > 300) { // –ñ–¥–µ—Ç 5 —Å–µ–∫—É–Ω–¥
                        customer.state = 'leaving';
                        customer.color = '#FFFFFF';
                        showNotification('üò† –ö–ª–∏–µ–Ω—Ç —É—à–µ–ª –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π');
                    }
                }
            });
        }
        
        function serveCustomer(tableId, drinkType) {
            const customer = gameState.customers.find(c => c.table === tableId && c.state === 'waiting');
            if (!customer) return false;
            
            if (customer.order === drinkType) {
                customer.state = 'eating';
                customer.color = '#00FF00'; // –ó–µ–ª–µ–Ω—ã–π - –µ—Å—Ç
                customer.patienceTimer = 0;
                
                // –ù–∞—á–∏—Å–ª—è–µ–º –¥–µ–Ω—å–≥–∏
                const earned = gameState.prices[drinkType];
                gameState.money += earned;
                gameState.earnedThisDay += earned;
                gameState.customersServed++;
                
                // –°–ø–∏—Å—ã–≤–∞–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
                gameState.inventory[drinkType]--;
                
                showNotification(`‚úÖ –û–±—Å–ª—É–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç! +$${earned}`);
                updateUI();
                return true;
            }
            return false;
        }
        
        // ==================== –ü–ï–†–°–û–ù–ê–ñ ====================
        function updatePlayer() {
            const player = gameState.player;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏
            if (player.targetX !== null && player.targetY !== null) {
                const dx = player.targetX - player.x;
                const dy = player.targetY - player.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.speed) {
                    player.x = player.targetX;
                    player.y = player.targetY;
                    player.targetX = null;
                    player.targetY = null;
                    player.isMoving = false;
                    player.color = '#000000'; // –ß–µ—Ä–Ω—ã–π - —Å—Ç–æ–∏—Ç
                    
                    // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–∏
                    if (player.interactionTarget) {
                        interactWithObject(player.interactionTarget);
                        player.interactionTarget = null;
                    }
                } else {
                    player.x += (dx / distance) * player.speed;
                    player.y += (dy / distance) * player.speed;
                    player.isMoving = true;
                    player.color = '#808080'; // –°–µ—Ä—ã–π - –∏–¥–µ—Ç
                }
            }
        }
        
        function movePlayerTo(x, y, interactWith = null) {
            gameState.player.targetX = x;
            gameState.player.targetY = y;
            gameState.player.interactionTarget = interactWith;
        }
        
        // ==================== –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø ====================
        function interactWithObject(object) {
            const player = gameState.player;
            
            if (object.type === 'door') {
                // –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏—è–º–∏
                gameState.location = gameState.location === 'bar' ? 'storage' : 'bar';
                player.x = gameState.location === 'bar' ? 100 : 700;
                player.y = 300;
                player.targetX = null;
                player.targetY = null;
                showNotification(`–ü–µ—Ä–µ—à–ª–∏ –≤ ${gameState.location === 'bar' ? '–±–∞—Ä' : '—Å–∫–ª–∞–¥'}`);
            }
            else if (object.type === 'cashier' && gameState.currentCustomer) {
                // –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑
                gameState.currentOrder = gameState.currentCustomer.order;
                gameState.currentCustomer = null;
                showNotification(`–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç: ${gameState.currentOrder === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'}`);
            }
            else if (object.type === 'machine' && gameState.currentOrder) {
                // –ù–∞—á–∞—Ç—å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ
                if (gameState.inventory[gameState.currentOrder] <= 0) {
                    showNotification('‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!');
                    return;
                }
                
                gameState.isPreparing = true;
                gameState.preparationProgress = 0;
                gameState.preparationTotal = gameState.currentOrder === 'coffee' ? 180 : 120; // 3 –∏–ª–∏ 2 —Å–µ–∫—É–Ω–¥—ã
                player.color = '#FFFF00'; // –ñ–µ–ª—Ç—ã–π - —Ä–∞–±–æ—Ç–∞–µ—Ç
                showNotification(`–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ ${gameState.currentOrder === 'coffee' ? '–∫–æ—Ñ–µ' : '—á–∞—è'}...`);
            }
            else if (object.type === 'table') {
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞ —Å—Ç–æ–ª–∏–∫–æ–º –∏ –æ—Ç–¥–∞—Ç—å –∑–∞–∫–∞–∑
                const drinkType = gameState.currentOrder;
                if (drinkType && serveCustomer(object.id, drinkType)) {
                    gameState.currentOrder = null;
                    gameState.isPreparing = false;
                }
            }
            else if (object.type === 'shelf') {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø–∞—Å–∞—Ö
                const ingredient = object.id.replace('_shelf', '');
                const current = gameState.inventory[ingredient];
                const max = gameState.storageCapacity[ingredient];
                showNotification(`${object.label}: ${current}/${max}`);
            }
            else if (object.type === 'board') {
                // –ó–∞–∫–∞–∑–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
                orderIngredients();
            }
            else if (object.type === 'button' && object.id === 'end_day') {
                // –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å
                endDay();
            }
        }
        
        function orderIngredients() {
            let orderText = "–ó–∞–∫–∞–∑–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:\n";
            let totalCost = 0;
            
            ['coffee', 'tea', 'milk', 'syrup'].forEach(ingredient => {
                const current = gameState.inventory[ingredient];
                const max = gameState.storageCapacity[ingredient];
                const need = max - current;
                
                if (need > 0) {
                    const cost = need * gameState.costs[ingredient];
                    totalCost += cost;
                    
                    if (gameState.money >= totalCost) {
                        gameState.inventory[ingredient] = max;
                        gameState.money -= cost;
                        orderText += `‚úÖ ${ingredient}: +${need} (-$${cost})\n`;
                    } else {
                        orderText += `‚ùå ${ingredient}: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥\n`;
                    }
                }
            });
            
            if (totalCost > 0) {
                showNotification(orderText);
                updateUI();
            } else {
                showNotification("–í—Å–µ –∑–∞–ø–∞—Å—ã –ø–æ–ª–Ω—ã–µ!");
            }
        }
        
        // ==================== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ====================
        function updateGame() {
            if (!gameState.dayActive) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –¥–Ω—è
            gameState.dayTime--;
            if (gameState.dayTime <= 0) {
                gameState.dayTime = 0;
                endDay();
            }
            
            // –°–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
            if (Date.now() > gameState.nextCustomerTime && gameState.customersToday < 5) {
                spawnCustomer();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
            updateCustomers();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            updatePlayer();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
            if (gameState.isPreparing) {
                gameState.preparationProgress++;
                if (gameState.preparationProgress >= gameState.preparationTotal) {
                    gameState.isPreparing = false;
                    showNotification(`‚úÖ ${gameState.currentOrder === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'} –≥–æ—Ç–æ–≤!`);
                }
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–∫–∞–∑—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
            if (!gameState.currentCustomer) {
                const waitingCustomer = gameState.customers.find(c => c.state === 'waiting');
                if (waitingCustomer) {
                    gameState.currentCustomer = waitingCustomer;
                    showNotification(`–ö–ª–∏–µ–Ω—Ç –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç: ${waitingCustomer.order === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'}`);
                }
            }
            
            updateUI();
        }
        
        // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
        function drawGame() {
            // –û—á–∏—Å—Ç–∫–∞ –∫–∞–Ω–≤–∞—Å–∞
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            // –†–∏—Å—É–µ–º –æ–±—ä–µ–∫—Ç—ã —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
            const objects = gameState.objects[gameState.location];
            objects.forEach(obj => {
                ctx.fillStyle = obj.color;
                
                if (obj.type === 'table') {
                    // –°—Ç–æ–ª–∏–∫
                    ctx.fillRect(obj.x - obj.width/2, obj.y - obj.height/2, obj.width, obj.height);
                    ctx.strokeStyle = '#fff';
                    ctx.strokeRect(obj.x - obj.width/2, obj.y - obj.height/2, obj.width, obj.height);
                } else if (obj.type === 'door') {
                    // –î–≤–µ—Ä—å
                    ctx.fillRect(obj.x - obj.width/2, obj.y - obj.height/2, obj.width, obj.height);
                } else {
                    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
                    ctx.fillRect(obj.x - obj.width/2, obj.y - obj.height/2, obj.width, obj.height);
                }
                
                // –ü–æ–¥–ø–∏—Å—å –æ–±—ä–µ–∫—Ç–∞
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(obj.label, obj.x, obj.y + obj.height/2 + 15);
            });
            
            // –†–∏—Å—É–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ –±–∞—Ä–µ)
            if (gameState.location === 'bar') {
                gameState.customers.forEach(customer => {
                    ctx.fillStyle = customer.color;
                    
                    if (customer.state === 'walking' || customer.state === 'leaving') {
                        // –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è –∏–¥—É—â–∏—Ö/—É—Ö–æ–¥—è—â–∏—Ö
                        ctx.beginPath();
                        ctx.moveTo(customer.x, customer.y - customer.size/2);
                        ctx.lineTo(customer.x - customer.size/2, customer.y + customer.size/2);
                        ctx.lineTo(customer.x + customer.size/2, customer.y + customer.size/2);
                        ctx.closePath();
                        ctx.fill();
                    } else {
                        // –ö—Ä—É–≥ –¥–ª—è –∂–¥—É—â–∏—Ö/–µ–¥—è—â–∏—Ö
                        ctx.beginPath();
                        ctx.arc(customer.x, customer.y, customer.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞
                    if (customer.state === 'waiting') {
                        ctx.fillStyle = customer.order === 'coffee' ? '#8B4513' : '#4CAF50';
                        ctx.beginPath();
                        ctx.arc(customer.x, customer.y - 20, 8, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
            }
            
            // –†–∏—Å—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            ctx.fillStyle = gameState.player.color;
            ctx.fillRect(
                gameState.player.x - gameState.player.size/2,
                gameState.player.y - gameState.player.size/2,
                gameState.player.size,
                gameState.player.size
            );
            
            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–∫–∞–∑–∞
            if (gameState.currentOrder) {
                ctx.fillStyle = gameState.currentOrder === 'coffee' ? '#8B4513' : '#4CAF50';
                ctx.beginPath();
                ctx.arc(gameState.player.x, gameState.player.y - 25, 10, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#fff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(gameState.currentOrder === 'coffee' ? 'C' : 'T', 
                           gameState.player.x, gameState.player.y - 22);
            }
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
            if (gameState.isPreparing) {
                const progress = gameState.preparationProgress / gameState.preparationTotal;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(10, GAME_HEIGHT - 30, GAME_WIDTH - 20, 20);
                
                ctx.fillStyle = '#1abc9c';
                ctx.fillRect(10, GAME_HEIGHT - 30, (GAME_WIDTH - 20) * progress, 20);
                
                ctx.fillStyle = '#fff';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(
                    `–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ ${gameState.currentOrder === 'coffee' ? '–∫–æ—Ñ–µ' : '—á–∞—è'}...`,
                    GAME_WIDTH / 2,
                    GAME_HEIGHT - 16
                );
            }
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–ª–∞–¥–µ (—Ç–æ–ª—å–∫–æ –Ω–∞ —Å–∫–ª–∞–¥–µ)
            if (gameState.location === 'storage') {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(10, 10, 200, 100);
                
                ctx.fillStyle = '#fff';
                ctx.font = '14px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('üì¶ –ó–ê–ü–ê–°–´:', 20, 30);
                
                let y = 50;
                ['coffee', 'tea', 'milk', 'syrup'].forEach(ingredient => {
                    const current = gameState.inventory[ingredient];
                    const max = gameState.storageCapacity[ingredient];
                    const percent = (current / max) * 100;
                    
                    ctx.fillStyle = percent < 30 ? '#e74c3c' : percent < 70 ? '#f39c12' : '#2ecc71';
                    ctx.fillText(
                        `${ingredient}: ${current}/${max}`,
                        20, y
                    );
                    y += 20;
                });
            }
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï ====================
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç
            const objects = gameState.objects[gameState.location];
            let clickedObject = null;
            
            for (const obj of objects) {
                const objLeft = obj.x - obj.width/2;
                const objRight = obj.x + obj.width/2;
                const objTop = obj.y - obj.height/2;
                const objBottom = obj.y + obj.height/2;
                
                if (x >= objLeft && x <= objRight && y >= objTop && y <= objBottom) {
                    clickedObject = obj;
                    break;
                }
            }
            
            if (clickedObject) {
                // –ò–¥–µ–º –∫ –æ–±—ä–µ–∫—Ç—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
                movePlayerTo(clickedObject.x, clickedObject.y, clickedObject);
            } else {
                // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è
                movePlayerTo(x, y);
            }
        });
        
        // ==================== –°–ò–°–¢–ï–ú–ê –î–ù–ï–ô ====================
        function endDay() {
            gameState.dayActive = false;
            document.getElementById('day-end-panel').style.display = 'block';
            document.getElementById('served-count').textContent = gameState.customersServed;
            document.getElementById('earned-money').textContent = `$${gameState.earnedThisDay}`;
            document.getElementById('total-money').textContent = `$${gameState.money}`;
            
            showNotification(`üìä –î–µ–Ω—å ${gameState.day} –∑–∞–≤–µ—Ä—à–µ–Ω!`);
        }
        
        function startNewDay() {
            gameState.day++;
            gameState.customersToday = 0;
            gameState.customersServed = 0;
            gameState.dayTime = 180;
            gameState.dayActive = true;
            gameState.earnedThisDay = 0;
            gameState.customers = [];
            gameState.nextCustomerTime = Date.now() + 5000; // –ü–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            
            document.getElementById('day-end-panel').style.display = 'none';
            showNotification(`üéÆ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–Ω—å ${gameState.day}!`);
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function init() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ù–∞—á–Ω–∏—Ç–µ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤.');
            }
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            function gameLoop() {
                updateGame();
                drawGame();
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
            
            // –ü–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (gameState.dayActive) {
                    gameState.nextCustomerTime = Date.now() + 5000;
                }
            }, 5000);
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', init);
    </script>
</body>
</html>
