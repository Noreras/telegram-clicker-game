<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Coffee Sim</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#0f3460}
canvas{display:block}
#ui{
position:fixed;top:10px;left:10px;
background:rgba(0,0,0,.6);color:#fff;
padding:10px;border-radius:10px;
font-family:sans-serif;font-size:14px
}
.notification{
position:fixed;right:20px;top:80px;
background:#00adb5;color:#fff;
padding:10px 14px;border-radius:10px;
animation:fade 3s forwards
}
@keyframes fade{0%{opacity:1}100%{opacity:0}}
</style>
</head>
<body>

<div id="ui">
üí∞ <span id="money">100</span><br>
üìÖ –î–µ–Ω—å <span id="day">1</span><br>
üë• <span id="served">0</span>/5<br>
‚è± <span id="time">3:00</span><br>
üìç <span id="loc">–ë–∞—Ä</span>
</div>

<canvas id="c"></canvas>

<script>
const c = document.getElementById('c')
const ctx = c.getContext('2d')
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();addEventListener('resize',resize)

/* ================= STATE ================= */
const state={
money:100,day:1,time:180,
customersSpawned:0,customersServed:0,
customers:[],
location:'bar',
player:{x:100,y:300,r:15,tx:null,ty:null,speed:4},
inventory:{coffee:5,tea:5},
capacity:{coffee:20,tea:20},
prices:{coffee:50,tea:40},
costs:{coffee:20,tea:15},
currentOrder:null,
cooking:null,
dayActive:true,
nextCustomer:5
}

/* ================= UTILS ================= */
function notify(t){
const d=document.createElement('div')
d.className='notification'
d.textContent=t
document.body.appendChild(d)
setTimeout(()=>d.remove(),3000)
}
function ui(){
money.textContent=state.money
day.textContent=state.day
served.textContent=state.customersServed
loc.textContent=state.location==='bar'?'–ë–∞—Ä':'–°–∫–ª–∞–¥'
time.textContent=`${Math.floor(state.time/60)}:${(state.time%60).toString().padStart(2,'0')}`
}

/* ================= OBJECTS ================= */
const BAR={
cash:{x:200,y:100,w:80,h:40,type:'cash'},
coffee:{x:320,y:100,w:50,h:50,type:'coffee'},
tea:{x:400,y:100,w:50,h:50,type:'tea'},
table1:{x:250,y:400,w:100,h:40,type:'table'},
table2:{x:400,y:400,w:100,h:40,type:'table'},
door:{x:550,y:250,w:60,h:120,type:'door'}
}

const STORAGE={
coffee:{x:200,y:150,w:100,h:50,type:'shelf',item:'coffee'},
tea:{x:200,y:250,w:100,h:50,type:'shelf',item:'tea'},
order:{x:400,y:200,w:160,h:50,type:'order'},
end:{x:400,y:300,w:160,h:50,type:'end'},
door:{x:50,y:250,w:60,h:120,type:'door'}
}

/* ================= CUSTOMER ================= */
function spawnCustomer(){
if(state.customersSpawned>=5)return
state.customersSpawned++
state.customers.push({
x:c.width+40,y:300,r:12,
state:'walking',
order:Math.random()<0.5?'coffee':'tea',
table:state.customers.length%2?BAR.table1:BAR.table2,
timer:0
})
notify('üÜï –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—à—ë–ª')
}

function updateCustomers(){
if(state.location!=='bar')return
state.customers.forEach(cu=>{
if(cu.state==='walking'){
cu.x-=2
if(cu.x<=cu.table.x)cu.state='waiting'
}
if(cu.state==='waiting'){
cu.timer++
if(cu.timer>600){cu.state='leaving';notify('üò† –ö–ª–∏–µ–Ω—Ç —É—à—ë–ª')}
}
if(cu.state==='served'){
cu.timer++
if(cu.timer>180)cu.state='leaving'
}
if(cu.state==='leaving')cu.x+=3
})
state.customers=state.customers.filter(cu=>cu.x<c.width+100)
}

/* ================= PLAYER ================= */
c.onclick=e=>{state.player.tx=e.clientX;state.player.ty=e.clientY}
function movePlayer(){
const p=state.player
if(p.tx===null)return
const dx=p.tx-p.x,dy=p.ty-p.y
const d=Math.hypot(dx,dy)
if(d<5){p.tx=null;return}
p.x+=dx/d*p.speed
p.y+=dy/d*p.speed
}

/* ================= INTERACTIONS ================= */
function near(o){
const p=state.player
return Math.abs(p.x-o.x)<o.w && Math.abs(p.y-o.y)<o.h
}

function interactions(){
const objs=state.location==='bar'?BAR:STORAGE

Object.values(objs).forEach(o=>{
if(!near(o))return

if(o.type==='door'){
state.location=state.location==='bar'?'storage':'bar'
state.player.x=state.location==='bar'?100:c.width-100
notify('üö™ –ü–µ—Ä–µ—Ö–æ–¥')
}

if(o.type==='cash'){
const cu=state.customers.find(c=>c.state==='waiting')
if(cu&&!state.currentOrder){
state.currentOrder={customer:cu,drink:cu.order}
notify(`üßæ ${cu.order}`)
}
}

if(o.type==='coffee'||o.type==='tea'){
if(state.currentOrder&&state.currentOrder.drink===o.type&&!state.cooking){
if(state.inventory[o.type]<=0){notify('‚ùå –ù–µ—Ç');return}
state.inventory[o.type]--
state.cooking={type:o.type,time:120,done:false}
notify('‚òï –ì–æ—Ç–æ–≤–∏–º')
}
}

if(o.type==='table'&&state.cooking&&state.cooking.done){
const cu=state.currentOrder.customer
cu.state='served'
state.money+=state.prices[state.cooking.type]
state.customersServed++
state.currentOrder=null
state.cooking=null
notify('‚úÖ –ü–æ–¥–∞–Ω–æ')
}

if(o.type==='shelf'){
notify(`${o.item}: ${state.inventory[o.item]}/${state.capacity[o.item]}`)
}

if(o.type==='order'){
let text=''
for(const k in state.inventory){
const need=state.capacity[k]-state.inventory[k]
const cost=need*state.costs[k]
if(need>0&&state.money>=cost){
state.money-=cost
state.inventory[k]+=need
text+=`+${k} `
}
}
notify(text||'‚ùå –î–µ–Ω–µ–≥ –Ω–µ—Ç')
}

if(o.type==='end'){
state.dayActive=false
notify('üìä –°–º–µ–Ω–∞ –æ–∫–æ–Ω—á–µ–Ω–∞')
}
})
}

/* ================= LOOP ================= */
let last=performance.now()
function loop(t){
const dt=(t-last)/1000
last=t

if(state.dayActive){
state.time-=dt
state.nextCustomer-=dt
if(state.nextCustomer<=0){spawnCustomer();state.nextCustomer=10}
}

if(state.cooking){
state.cooking.time--
if(state.cooking.time<=0)state.cooking.done=true
}

updateCustomers()
movePlayer()
interactions()
ui()
draw()
requestAnimationFrame(loop)
}

/* ================= DRAW ================= */
function draw(){
ctx.clearRect(0,0,c.width,c.height)
const objs=state.location==='bar'?BAR:STORAGE

Object.values(objs).forEach(o=>{
ctx.fillStyle='#777'
ctx.fillRect(o.x-o.w/2,o.y-o.h/2,o.w,o.h)
ctx.fillStyle='#fff'
ctx.fillText(o.type,o.x-15,o.y)
})

if(state.location==='bar'){
state.customers.forEach(cu=>{
ctx.fillStyle=cu.state==='waiting'?'yellow':'white'
ctx.beginPath();ctx.arc(cu.x,cu.y,cu.r,0,Math.PI*2);ctx.fill()
})
}

const p=state.player
ctx.fillStyle='black'
ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill()
}

loop()
</script>
</body>
</html>
