<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ—Ñ–µ–π–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #1a1a2e;
        }
        
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
        }
        
        #game-canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #0f3460;
        }
        
        #game-ui {
            position: fixed;
            top: env(safe-area-inset-top, 0);
            left: 0;
            right: 0;
            padding: 12px 16px;
            background: linear-gradient(to bottom, rgba(26, 26, 46, 0.95), rgba(26, 26, 46, 0.8));
            color: white;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00adb5;
        }
        
        .ui-item {
            text-align: center;
        }
        
        .ui-label {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 4px;
            color: #a0a0c0;
        }
        
        .ui-value {
            font-size: 16px;
            font-weight: 700;
            color: #00adb5;
        }
        
        #location-indicator {
            position: fixed;
            top: calc(env(safe-area-inset-top, 0) + 70px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 173, 181, 0.9);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            z-index: 99;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .notification {
            position: fixed;
            top: calc(env(safe-area-inset-top, 0) + 110px);
            right: 16px;
            background: #00adb5;
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        #day-end-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 1000;
            display: none;
        }
        
        .panel-content {
            background: #16213e;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 3px solid #00adb5;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }
        
        .panel-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: #00adb5;
            font-weight: 700;
        }
        
        .panel-stat {
            font-size: 17px;
            margin: 12px 0;
            color: #e0e0ff;
        }
        
        .panel-highlight {
            color: #00ff9d;
            font-weight: 700;
        }
        
        .panel-button {
            background: linear-gradient(135deg, #00adb5, #0097a7);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 25px;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .panel-button:active {
            transform: scale(0.98);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        #instructions {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 0) + 20px);
            left: 16px;
            right: 16px;
            background: rgba(26, 26, 46, 0.9);
            color: #a0a0c0;
            padding: 15px;
            border-radius: 15px;
            font-size: 13px;
            line-height: 1.4;
            text-align: center;
            z-index: 99;
            border: 1px solid #2d4059;
        }
        
        #progress-bar {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 0) + 90px);
            left: 16px;
            right: 16px;
            height: 8px;
            background: rgba(45, 64, 89, 0.5);
            border-radius: 4px;
            overflow: hidden;
            z-index: 99;
        }
        
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00adb5, #00ff9d);
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (max-width: 480px) {
            #game-ui {
                padding: 10px 12px;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            
            .ui-label {
                font-size: 10px;
            }
            
            .ui-value {
                font-size: 14px;
            }
            
            #location-indicator {
                font-size: 12px;
                padding: 6px 16px;
                top: calc(env(safe-area-inset-top, 0) + 60px);
            }
            
            .notification {
                font-size: 13px;
                top: calc(env(safe-area-inset-top, 0) + 90px);
            }
            
            .panel-content {
                padding: 25px;
            }
            
            .panel-title {
                font-size: 20px;
            }
            
            .panel-stat {
                font-size: 16px;
            }
        }
        
        /* –î–ª—è Telegram Web App */
        body.telegram-webapp {
            background: transparent;
        }
    </style>
</head>
<body class="telegram-webapp">
    <div id="game-container">
        <div id="game-ui">
            <div class="ui-item">
                <div class="ui-label">–ë–ê–õ–ê–ù–°</div>
                <div class="ui-value" id="money">$100</div>
            </div>
            <div class="ui-item">
                <div class="ui-label">–î–ï–ù–¨</div>
                <div class="ui-value" id="day">1</div>
            </div>
            <div class="ui-item">
                <div class="ui-label">–ö–õ–ò–ï–ù–¢–´</div>
                <div class="ui-value" id="customers">0/5</div>
            </div>
            <div class="ui-item">
                <div class="ui-label">–í–†–ï–ú–Ø</div>
                <div class="ui-value" id="day-time">3:00</div>
            </div>
        </div>
        
        <div id="location-indicator">–ë–ê–†–ù–ê–Ø –ó–û–ù–ê</div>
        
        <canvas id="game-canvas"></canvas>
        
        <div id="progress-bar">
            <div id="progress-fill"></div>
        </div>
        
        <div id="instructions">
            üëÜ –¢–∞–ø–Ω–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è ‚Ä¢ üéØ –¢–∞–ø–Ω–∏—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è
        </div>
        
        <div id="day-end-panel">
            <div class="panel-content">
                <div class="panel-title">üéâ –°–ú–ï–ù–ê –ó–ê–í–ï–†–®–ï–ù–ê!</div>
                <div class="panel-stat">–û–±—Å–ª—É–∂–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: <span class="panel-highlight" id="served-count">0</span></div>
                <div class="panel-stat">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –¥–µ–Ω—å: <span class="panel-highlight" id="earned-money">$0</span></div>
                <div class="panel-stat">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: <span class="panel-highlight" id="total-money">$100</span></div>
                <button class="panel-button" onclick="startNewDay()">–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // ==================== –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ====================
        const gameState = {
            location: 'bar',
            money: 100,
            day: 1,
            customersToday: 0,
            customersServed: 0,
            dayTime: 180, // 3 –º–∏–Ω—É—Ç—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            dayActive: true,
            earnedThisDay: 0,
            
            inventory: {
                coffee: 10,
                tea: 10,
                milk: 0,
                syrup: 0
            },
            
            prices: {
                coffee: 50,
                tea: 40,
                latte: 80,
                cappuccino: 90
            },
            
            costs: {
                coffee: 20,
                tea: 15,
                milk: 30,
                syrup: 25
            },
            
            storageCapacity: {
                coffee: 20,
                tea: 20,
                milk: 10,
                syrup: 10
            },
            
            currentCustomer: null,
            currentOrder: null,
            isPreparing: false,
            preparationProgress: 0,
            preparationTotal: 0,
            
            player: {
                x: 0,
                y: 0,
                size: 20,
                color: '#000000',
                targetX: null,
                targetY: null,
                speed: 4,
                isMoving: false,
                interactionTarget: null
            },
            
            customers: [],
            nextCustomerTime: 0,
            
            // –†–∞–∑–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ
            objects: {
                bar: [],
                storage: []
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
        function initObjects() {
            const width = canvas.width;
            const height = canvas.height;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç–∫—Ä–∞–Ω–∞
            const objSize = Math.min(width, height) * 0.05;
            const playerSize = Math.min(width, height) * 0.04;
            
            gameState.player.size = playerSize;
            
            gameState.objects.bar = [
                { 
                    id: 'cashier', type: 'cashier', 
                    x: width * 0.15, y: height * 0.2, 
                    width: objSize * 2, height: objSize * 1.5, 
                    color: '#3498db', label: '–ö–∞—Å—Å–∞',
                    collision: true
                },
                { 
                    id: 'coffee_machine', type: 'machine', 
                    x: width * 0.3, y: height * 0.2, 
                    width: objSize * 1.5, height: objSize * 1.5, 
                    color: '#e74c3c', label: '–ö–æ—Ñ–µ',
                    collision: true
                },
                { 
                    id: 'tea_maker', type: 'machine', 
                    x: width * 0.45, y: height * 0.2, 
                    width: objSize * 1.5, height: objSize * 1.5, 
                    color: '#2ecc71', label: '–ß–∞–π',
                    collision: true
                },
                { 
                    id: 'table1', type: 'table', 
                    x: width * 0.25, y: height * 0.7, 
                    width: objSize * 3, height: objSize * 1.5, 
                    color: '#9b59b6', label: '–°—Ç–æ–ª 1',
                    collision: true
                },
                { 
                    id: 'table2', type: 'table', 
                    x: width * 0.5, y: height * 0.7, 
                    width: objSize * 3, height: objSize * 1.5, 
                    color: '#9b59b6', label: '–°—Ç–æ–ª 2',
                    collision: true
                },
                { 
                    id: 'door', type: 'door', 
                    x: width * 0.9, y: height * 0.5, 
                    width: objSize * 0.8, height: objSize * 3, 
                    color: '#f39c12', label: '‚Üí –°–∫–ª–∞–¥',
                    collision: false
                }
            ];
            
            gameState.objects.storage = [
                { 
                    id: 'coffee_shelf', type: 'shelf', 
                    x: width * 0.2, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#795548', label: '–ö–æ—Ñ–µ',
                    collision: true
                },
                { 
                    id: 'tea_shelf', type: 'shelf', 
                    x: width * 0.4, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#4CAF50', label: '–ß–∞–π',
                    collision: true
                },
                { 
                    id: 'milk_shelf', type: 'shelf', 
                    x: width * 0.6, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#FFEBEE', label: '–ú–æ–ª–æ–∫–æ',
                    collision: true
                },
                { 
                    id: 'syrup_shelf', type: 'shelf', 
                    x: width * 0.8, y: height * 0.3, 
                    width: objSize * 3, height: objSize * 2, 
                    color: '#FF9800', label: '–°–∏—Ä–æ–ø',
                    collision: true
                },
                { 
                    id: 'order_board', type: 'board', 
                    x: width * 0.4, y: height * 0.6, 
                    width: objSize * 4, height: objSize * 2, 
                    color: '#607D8B', label: '–ó–∞–∫–∞–∑–∞—Ç—å',
                    collision: true
                },
                { 
                    id: 'end_day', type: 'button', 
                    x: width * 0.4, y: height * 0.8, 
                    width: objSize * 5, height: objSize * 2, 
                    color: '#e74c3c', label: '–ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É',
                    collision: true
                },
                { 
                    id: 'door_back', type: 'door', 
                    x: width * 0.1, y: height * 0.5, 
                    width: objSize * 0.8, height: objSize * 3, 
                    color: '#f39c12', label: '‚Üê –ë–∞—Ä',
                    collision: false
                }
            ];
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
            if (gameState.location === 'bar') {
                gameState.player.x = width * 0.1;
                gameState.player.y = height * 0.5;
            } else {
                gameState.player.x = width * 0.9;
                gameState.player.y = height * 0.5;
            }
        }
        
        // ==================== –ö–û–õ–õ–ò–ó–ò–ò ====================
        function checkCollision(x, y, object) {
            const left = object.x - object.width / 2;
            const right = object.x + object.width / 2;
            const top = object.y - object.height / 2;
            const bottom = object.y + object.height / 2;
            
            return x >= left && x <= right && y >= top && y <= bottom;
        }
        
        function isValidPosition(x, y) {
            const objects = gameState.objects[gameState.location];
            
            for (const obj of objects) {
                if (obj.collision && checkCollision(x, y, obj)) {
                    return false;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
            return x > gameState.player.size && 
                   x < canvas.width - gameState.player.size && 
                   y > gameState.player.size && 
                   y < canvas.height - gameState.player.size;
        }
        
        function findValidPath(startX, startY, targetX, targetY) {
            // –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏ (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
            const dx = targetX - startX;
            const dy = targetY - startY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const steps = Math.ceil(distance / gameState.player.speed);
            
            for (let i = 1; i <= steps; i++) {
                const x = startX + (dx / steps) * i;
                const y = startY + (dy / steps) * i;
                
                if (!isValidPosition(x, y)) {
                    // –ï—Å–ª–∏ –ø—É—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –∏—â–µ–º –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å
                    const angle = Math.atan2(dy, dx);
                    const offsetX = Math.cos(angle + Math.PI/2) * 50;
                    const offsetY = Math.sin(angle + Math.PI/2) * 50;
                    
                    const newX1 = startX + offsetX;
                    const newY1 = startY + offsetY;
                    const newX2 = startX - offsetX;
                    const newY2 = startY - offsetY;
                    
                    if (isValidPosition(newX1, newY1)) {
                        return { x: newX1, y: newY1 };
                    } else if (isValidPosition(newX2, newY2)) {
                        return { x: newX2, y: newY2 };
                    }
                    
                    return null;
                }
            }
            
            return { x: targetX, y: targetY };
        }
        
        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showNotification(text) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = text;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 2500);
            
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.showAlert(text);
            }
        }
        
        function updateUI() {
            document.getElementById('money').textContent = `$${gameState.money}`;
            document.getElementById('day').textContent = gameState.day;
            document.getElementById('customers').textContent = `${gameState.customersServed}/${gameState.customersToday}`;
            
            const minutes = Math.floor(gameState.dayTime / 60);
            const seconds = gameState.dayTime % 60;
            document.getElementById('day-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('location-indicator').textContent = 
                gameState.location === 'bar' ? '–ë–ê–†–ù–ê–Ø –ó–û–ù–ê' : '–°–ö–õ–ê–î';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            const progress = (gameState.customersServed / 5) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }
        
        // ==================== –ö–õ–ò–ï–ù–¢–´ ====================
        function spawnCustomer() {
            if (gameState.customersToday >= 5 || !gameState.dayActive) return;
            
            const table = gameState.customers.length === 0 ? 'table1' : 'table2';
            const customer = {
                id: Date.now(),
                table: table,
                x: canvas.width * 0.9,
                y: canvas.height * 0.2,
                size: Math.min(canvas.width, canvas.height) * 0.03,
                color: '#FFFFFF',
                state: 'walking',
                order: null,
                patience: 100,
                patienceTimer: 0
            };
            
            const orders = ['coffee', 'tea'];
            customer.order = orders[Math.floor(Math.random() * orders.length)];
            
            gameState.customers.push(customer);
            gameState.customersToday++;
            gameState.nextCustomerTime = Date.now() + 15000;
            
            showNotification('üÜï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç!');
            updateUI();
        }
        
        function updateCustomers() {
            gameState.customers.forEach((customer, index) => {
                if (customer.state === 'walking') {
                    const table = gameState.objects.bar.find(obj => obj.id === customer.table);
                    const targetX = table.x;
                    const targetY = table.y - table.height;
                    
                    const dx = targetX - customer.x;
                    const dy = targetY - customer.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 5) {
                        customer.state = 'waiting';
                        customer.color = '#FFFF00';
                    } else {
                        customer.x += (dx / distance) * 3;
                        customer.y += (dy / distance) * 3;
                    }
                }
                else if (customer.state === 'eating') {
                    customer.patienceTimer++;
                    if (customer.patienceTimer > 180) {
                        customer.state = 'leaving';
                        customer.color = '#FFFFFF';
                    }
                }
                else if (customer.state === 'leaving') {
                    customer.x += 3;
                    if (customer.x > canvas.width + 50) {
                        gameState.customers.splice(index, 1);
                    }
                }
                else if (customer.state === 'waiting') {
                    customer.patienceTimer++;
                    if (customer.patienceTimer > 300) {
                        customer.state = 'leaving';
                        customer.color = '#FFFFFF';
                        showNotification('üò† –ö–ª–∏–µ–Ω—Ç —É—à–µ–ª –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π');
                    }
                }
            });
        }
        
        function serveCustomer(tableId, drinkType) {
            const customer = gameState.customers.find(c => c.table === tableId && c.state === 'waiting');
            if (!customer) return false;
            
            if (customer.order === drinkType) {
                customer.state = 'eating';
                customer.color = '#00FF00';
                customer.patienceTimer = 0;
                
                const earned = gameState.prices[drinkType];
                gameState.money += earned;
                gameState.earnedThisDay += earned;
                gameState.customersServed++;
                
                gameState.inventory[drinkType]--;
                
                showNotification(`‚úÖ –û–±—Å–ª—É–∂–µ–Ω –∫–ª–∏–µ–Ω—Ç! +$${earned}`);
                updateUI();
                return true;
            }
            return false;
        }
        
        // ==================== –ü–ï–†–°–û–ù–ê–ñ ====================
        function updatePlayer() {
            const player = gameState.player;
            
            if (player.targetX !== null && player.targetY !== null) {
                const dx = player.targetX - player.x;
                const dy = player.targetY - player.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.speed) {
                    player.x = player.targetX;
                    player.y = player.targetY;
                    player.targetX = null;
                    player.targetY = null;
                    player.isMoving = false;
                    player.color = '#000000';
                    
                    if (player.interactionTarget) {
                        interactWithObject(player.interactionTarget);
                        player.interactionTarget = null;
                    }
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ –ø–æ –ø—É—Ç–∏
                    const nextX = player.x + (dx / distance) * player.speed;
                    const nextY = player.y + (dy / distance) * player.speed;
                    
                    if (isValidPosition(nextX, nextY)) {
                        player.x = nextX;
                        player.y = nextY;
                        player.isMoving = true;
                        player.color = '#808080';
                    } else {
                        // –ü—É—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –∏—â–µ–º –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å
                        const newTarget = findValidPath(player.x, player.y, player.targetX, player.targetY);
                        if (newTarget) {
                            player.targetX = newTarget.x;
                            player.targetY = newTarget.y;
                        } else {
                            player.targetX = null;
                            player.targetY = null;
                            player.interactionTarget = null;
                            showNotification('üö´ –ü—É—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
                        }
                    }
                }
            }
        }
        
        function movePlayerTo(x, y, interactWith = null) {
            const validTarget = findValidPath(gameState.player.x, gameState.player.y, x, y);
            if (validTarget) {
                gameState.player.targetX = validTarget.x;
                gameState.player.targetY = validTarget.y;
                gameState.player.interactionTarget = interactWith;
            } else {
                showNotification('üö´ –ù–µ –º–æ–≥—É –¥–æ–π—Ç–∏ –¥–æ —ç—Ç–æ–π —Ç–æ—á–∫–∏!');
            }
        }
        
        // ==================== –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø ====================
        function interactWithObject(object) {
            const player = gameState.player;
            
            if (object.type === 'door') {
                // –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏—è–º–∏
                gameState.location = gameState.location === 'bar' ? 'storage' : 'bar';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞ —Ä—è–¥–æ–º —Å –¥–≤–µ—Ä—å—é
                if (gameState.location === 'bar') {
                    gameState.player.x = canvas.width * 0.1;
                    gameState.player.y = canvas.height * 0.5;
                } else {
                    gameState.player.x = canvas.width * 0.9;
                    gameState.player.y = canvas.height * 0.5;
                }
                
                gameState.player.targetX = null;
                gameState.player.targetY = null;
                showNotification(`–ü–µ—Ä–µ—à–ª–∏ –≤ ${gameState.location === 'bar' ? '–±–∞—Ä' : '—Å–∫–ª–∞–¥'}`);
            }
            else if (object.type === 'cashier' && gameState.currentCustomer) {
                gameState.currentOrder = gameState.currentCustomer.order;
                gameState.currentCustomer = null;
                showNotification(`–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç: ${gameState.currentOrder === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'}`);
            }
            else if (object.type === 'machine' && gameState.currentOrder) {
                if (gameState.inventory[gameState.currentOrder] <= 0) {
                    showNotification('‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!');
                    return;
                }
                
                gameState.isPreparing = true;
                gameState.preparationProgress = 0;
                gameState.preparationTotal = gameState.currentOrder === 'coffee' ? 180 : 120;
                player.color = '#FFFF00';
                showNotification(`–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ ${gameState.currentOrder === 'coffee' ? '–∫–æ—Ñ–µ' : '—á–∞—è'}...`);
            }
            else if (object.type === 'table') {
                const drinkType = gameState.currentOrder;
                if (drinkType && serveCustomer(object.id, drinkType)) {
                    gameState.currentOrder = null;
                    gameState.isPreparing = false;
                }
            }
            else if (object.type === 'shelf') {
                const ingredient = object.id.replace('_shelf', '');
                const current = gameState.inventory[ingredient];
                const max = gameState.storageCapacity[ingredient];
                showNotification(`${object.label}: ${current}/${max}`);
            }
            else if (object.type === 'board') {
                orderIngredients();
            }
            else if (object.type === 'button' && object.id === 'end_day') {
                endDay();
            }
        }
        
        function orderIngredients() {
            let orderText = "–ó–∞–∫–∞–∑–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:\n";
            let totalCost = 0;
            let ordered = false;
            
            ['coffee', 'tea', 'milk', 'syrup'].forEach(ingredient => {
                const current = gameState.inventory[ingredient];
                const max = gameState.storageCapacity[ingredient];
                const need = max - current;
                
                if (need > 0) {
                    const cost = need * gameState.costs[ingredient];
                    
                    if (gameState.money >= totalCost + cost) {
                        gameState.inventory[ingredient] = max;
                        totalCost += cost;
                        gameState.money -= cost;
                        orderText += `‚úÖ ${ingredient}: +${need} (-$${cost})\n`;
                        ordered = true;
                    } else {
                        orderText += `‚ùå ${ingredient}: –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥\n`;
                    }
                }
            });
            
            if (ordered) {
                showNotification(orderText);
                updateUI();
            } else if (totalCost === 0) {
                showNotification("–í—Å–µ –∑–∞–ø–∞—Å—ã –ø–æ–ª–Ω—ã–µ!");
            } else {
                showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –∑–∞–∫–∞–∑–∞!");
            }
        }
        
        // ==================== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ====================
        function updateGame() {
            if (!gameState.dayActive) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –¥–Ω—è (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
            gameState.dayTime--;
            if (gameState.dayTime < 0) {
                gameState.dayTime = 0;
                // –í—Ä–µ–º—è –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç –¥–µ–Ω—å - —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä
            }
            
            // –°–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
            if (Date.now() > gameState.nextCustomerTime && gameState.customersToday < 5) {
                spawnCustomer();
            }
            
            updateCustomers();
            updatePlayer();
            
            if (gameState.isPreparing) {
                gameState.preparationProgress++;
                if (gameState.preparationProgress >= gameState.preparationTotal) {
                    gameState.isPreparing = false;
                    showNotification(`‚úÖ ${gameState.currentOrder === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'} –≥–æ—Ç–æ–≤!`);
                }
            }
            
            if (!gameState.currentCustomer) {
                const waitingCustomer = gameState.customers.find(c => c.state === 'waiting');
                if (waitingCustomer) {
                    gameState.currentCustomer = waitingCustomer;
                    showNotification(`–ö–ª–∏–µ–Ω—Ç –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç: ${waitingCustomer.order === 'coffee' ? '–ö–æ—Ñ–µ' : '–ß–∞–π'}`);
                }
            }
            
            updateUI();
        }
        
        // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
        function drawGame() {
            // –û—á–∏—Å—Ç–∫–∞
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É —Ñ–æ–Ω–∞
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            const gridSize = 50;
            
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // –†–∏—Å—É–µ–º –æ–±—ä–µ–∫—Ç—ã
            const objects = gameState.objects[gameState.location];
            objects.forEach(obj => {
                // –†–∏—Å—É–µ–º –æ–±—ä–µ–∫—Ç
                ctx.fillStyle = obj.color;
                ctx.fillRect(
                    obj.x - obj.width/2, 
                    obj.y - obj.height/2, 
                    obj.width, 
                    obj.height
                );
                
                // –ö–æ–Ω—Ç—É—Ä –æ–±—ä–µ–∫—Ç–∞
                ctx.strokeStyle = obj.collision ? '#ffffff' : '#ffcc00';
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    obj.x - obj.width/2, 
                    obj.y - obj.height/2, 
                    obj.width, 
                    obj.height
                );
                
                // –ü–æ–¥–ø–∏—Å—å –æ–±—ä–µ–∫—Ç–∞
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.min(canvas.width, canvas.height) * 0.02}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(obj.label, obj.x, obj.y);
            });
            
            // –†–∏—Å—É–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ –±–∞—Ä–µ)
            if (gameState.location === 'bar') {
                gameState.customers.forEach(customer => {
                    ctx.fillStyle = customer.color;
                    
                    if (customer.state === 'walking' || customer.state === 'leaving') {
                        // –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
                        ctx.beginPath();
                        ctx.moveTo(customer.x, customer.y - customer.size/2);
                        ctx.lineTo(customer.x - customer.size/2, customer.y + customer.size/2);
                        ctx.lineTo(customer.x + customer.size/2, customer.y + customer.size/2);
                        ctx.closePath();
                        ctx.fill();
                        
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    } else {
                        // –ö—Ä—É–≥ –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è/–µ–¥–µ–Ω–∏—è
                        ctx.beginPath();
                        ctx.arc(customer.x, customer.y, customer.size, 0, Math.PI * 2);
                        ctx.fill();
                        
                        ctx.strokeStyle = '#ffffff';
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                    
                    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞
                    if (customer.state === 'waiting') {
                        ctx.fillStyle = customer.order === 'coffee' ? '#8B4513' : '#4CAF50';
                        ctx.beginPath();
                        ctx.arc(customer.x, customer.y - customer.size * 1.5, customer.size * 0.6, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
            }
            
            // –†–∏—Å—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            const player = gameState.player;
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
            ctx.fill();
            
            // –ö–æ–Ω—Ç—É—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ –Ω–∞–¥ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
            if (gameState.currentOrder) {
                ctx.fillStyle = gameState.currentOrder === 'coffee' ? '#8B4513' : '#4CAF50';
                ctx.beginPath();
                ctx.arc(player.x, player.y - player.size * 2, player.size * 
